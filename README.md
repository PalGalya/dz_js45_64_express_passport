# Express Server –∑ Mongoose ORM —Ç–∞ Passport –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é

> **71: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Mongoose –¥–ª—è –ø–æ–≤–Ω–æ—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ fullstack –ø—Ä–æ–µ–∫—Ç—É**

## üìã –û–ø–∏—Å –ø—Ä–æ–µ–∫—Ç—É

–¶–µ –ø–æ–≤–Ω–æ—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π Express —Å–µ—Ä–≤–µ—Ä –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é **Mongoose ORM** –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ MongoDB, —â–æ –≤–∫–ª—é—á–∞—î:

- üîê **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é** —á–µ—Ä–µ–∑ Passport.js –∑ –ª–æ–∫–∞–ª—å–Ω–æ—é —Å—Ç—Ä–∞—Ç–µ–≥—ñ—î—é
- üì¶ **CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó** –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
- ‚úÖ **–í–∞–ª—ñ–¥–∞—Ü—ñ—é** –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ Celebrate + Joi
- üóÑÔ∏è **Mongoose –º–æ–¥–µ–ª—ñ** –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é —Ç–∞ —ñ–Ω–¥–µ–∫—Å–∞–º–∏
- üîí **–ó–∞—Ö–∏—â–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏** –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

---

## üéØ –ú–µ—Ç–∞ –∑–∞–≤–¥–∞–Ω–Ω—è

1. ‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏**: –ü–µ—Ä–µ—Ä–æ–±–∏—Ç–∏ backend –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **Mongoose** –∑–∞–º—ñ—Å—Ç—å raw MongoDB –¥—Ä–∞–π–≤–µ—Ä–∞
2. ‚úÖ **–†–æ–∑—Ä–æ–±–∫–∞ API**: –†–æ–∑—Ä–æ–±–∏—Ç–∏/–æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ API –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –∑–≤'—è–∑–∫—É –∑ frontend —á–∞—Å—Ç–∏–Ω–æ—é –Ω–∞ React
3. ‚úÖ **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ**: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ –ø—ñ—Å–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É
4. ‚úÖ **MongoDB Mongoose**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **Mongoose —è–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ORM** –¥–ª—è MongoDB

---

## üõ†Ô∏è –¢–µ—Ö–Ω—ñ—á–Ω—ñ –≤–∏–º–æ–≥–∏

### 1. –†–æ–∑—Ä–æ–±–∫–∞ —Å—Ö–µ–º –¥–∞–Ω–∏—Ö

- ‚úÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å—Ö–µ–º–∏ Mongoose –¥–ª—è –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ—Ç—Ä—ñ–±–Ω–∏—Ö –¥–∞–Ω–∏—Ö —É –ø—Ä–æ–µ–∫—Ç—ñ
- ‚úÖ –í–∫–ª—é—á–∏—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é —Ç–∞ —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—é –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö

### 2. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø—É –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

- ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–¥–µ–ª—ñ Mongoose –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –±–µ–∑–ø–µ–∫–∏ –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö

### 3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ

- ‚úÖ –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤—Å—ñ —ñ—Å–Ω—É—é—á—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ –ø—ñ—Å–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É
- ‚úÖ –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∑–∞—î–º–æ–¥—ñ—ó –º—ñ–∂ backend –Ω–∞ Mongoose —Ç–∞ frontend –Ω–∞ React

---

## üì¶ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

```json
{
  "express": "^5.1.0",
  "mongoose": "^8.0.0",
  "passport": "^0.7.0",
  "passport-local": "^1.0.0",
  "express-session": "^1.17.3",
  "celebrate": "^15.0.3",
  "joi": "^18.0.1",
  "bcrypt": "^5.1.0",
  "dotenv": "^17.2.3"
}
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
src/
‚îú‚îÄ‚îÄ app.mjs                          # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –¥–æ–¥–∞—Ç–∫—É
‚îú‚îÄ‚îÄ config.mjs                       # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (–≤–∏–º–∞–≥–∞—î .env)
‚îÇ
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îî‚îÄ‚îÄ passport.mjs                 # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Passport.js –∑ Mongoose
‚îÇ
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ auth.mjs                     # –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
‚îÇ   ‚îî‚îÄ‚îÄ products.mjs                 # –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (CRUD)
‚îÇ
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ auth.mjs                     # Middleware –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
‚îÇ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ user.mjs                     # Mongoose –º–æ–¥–µ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
‚îÇ   ‚îî‚îÄ‚îÄ product.mjs                  # Mongoose –º–æ–¥–µ–ª—å –ø—Ä–æ–¥—É–∫—Ç—É
‚îÇ
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ auth.mjs                     # –ú–∞—Ä—à—Ä—É—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ index.mjs                    # –û—Å–Ω–æ–≤–Ω–∏–π —Ä–æ—É—Ç–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ products.mjs                 # –ú–∞—Ä—à—Ä—É—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (CRUD)
‚îÇ   ‚îú‚îÄ‚îÄ cursor.mjs                   # –ú–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è –∫—É—Ä—Å–æ—Ä—ñ–≤
‚îÇ   ‚îî‚îÄ‚îÄ aggregation.mjs              # –ú–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó
‚îÇ
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ mongodb.mjs                  # –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MongoDB –∑ Mongoose
‚îÇ
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ initUsers.mjs                # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
‚îÇ
‚îî‚îÄ‚îÄ public/
    ‚îî‚îÄ‚îÄ products.html                # –°—Ç–∞—Ç–∏—á–Ω–∞ HTML —Å—Ç–æ—Ä—ñ–Ω–∫–∞
```

---

## üîë Mongoose –ú–æ–¥–µ–ª—ñ

### User Model

```javascript
{
  id: String (unique, required),
  email: String (unique, required, email validation),
  username: String (required),
  password: String (required, hashed with bcrypt, min 6 chars),
  role: String (enum: 'user' | 'admin', default: 'user'),
  createdAt: Date (auto),
  updatedAt: Date (auto)
}
```

**–í–∞–∂–ª–∏–≤–æ:** –ü–∞—Ä–æ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ—à—É—î—Ç—å—Å—è –∑ bcrypt –ø–µ—Ä–µ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º (salt rounds: 10).

### Product Model

```javascript
{
  id: Number (unique, required, auto-incremented),
  name: String (required, min 3 chars, max 100),
  description: String (required, min 10 chars),
  price: Number (required, min 0),
  category: String (enum: 'electronics' | 'clothing' | 'food' | 'furniture', required),
  image: String (optional, can be null),
  stock: Number (default 0, min 0),
  rating: Number (optional, range 0-5),
  createdAt: Date (auto),
  updatedAt: Date (auto)
}
```

**–ü—Ä–∏–∫–ª–∞–¥ –¥–æ–∫—É–º–µ–Ω—Ç—É:**

```json
{
  "id": 1,
  "name": "–ù–æ—É—Ç–±—É–∫",
  "description": "–ü–æ—Ç—É–∂–Ω–∏–π –Ω–æ—É—Ç–±—É–∫ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ä–æ–∑—Ä–æ–±–∫–∏",
  "price": 25000,
  "category": "electronics",
  "image": "laptop.jpg",
  "stock": 10,
  "rating": 4.5,
  "createdAt": "2024-01-15T10:30:00Z",
  "updatedAt": "2024-01-15T10:30:00Z"
}
```

---

## üöÄ API Endpoints

### üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è

| –ú–µ—Ç–æ–¥ | –ú–∞—Ä—à—Ä—É—Ç           | –û–ø–∏—Å                          | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è | –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É           |
| ----- | ----------------- | ----------------------------- | ----------- | --------------------- |
| POST  | `/auth/register`  | –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ | ‚ùå          | `{ email, password }` |
| POST  | `/auth/login`     | –í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É                | ‚ùå          | `{ email, password }` |
| POST  | `/auth/logout`    | –í–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏               | ‚úÖ          | ‚Äî                     |
| GET   | `/auth/me`        | –î–∞–Ω—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞    | ‚úÖ          | ‚Äî                     |
| GET   | `/auth/protected` | –ó–∞—Ö–∏—â–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ (–¥–µ–º–æ)      | ‚úÖ          | ‚Äî                     |

### üì¶ –ü—Ä–æ–¥—É–∫—Ç–∏ (CRUD)

| –ú–µ—Ç–æ–¥  | –ú–∞—Ä—à—Ä—É—Ç             | –û–ø–∏—Å                   | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è | –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É                                                           |
| ------ | ------------------- | ---------------------- | ----------- | --------------------------------------------------------------------- |
| GET    | `/api/products`     | –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –ø—Ä–æ–¥—É–∫—Ç–∏  | ‚ùå          | ‚Äî                                                                     |
| GET    | `/api/products/:id` | –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç –∑–∞ ID | ‚ùå          | ‚Äî                                                                     |
| POST   | `/api/products`     | –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç       | ‚úÖ          | `{ name, price, description, category, image?, stock?, rating? }`     |
| PUT    | `/api/products/:id` | –û–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç        | ‚úÖ          | `{ name?, price?, description?, category?, image?, stock?, rating? }` |
| DELETE | `/api/products/:id` | –í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç       | ‚úÖ          | ‚Äî                                                                     |

### üîç –î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–∞—Ä—à—Ä—É—Ç–∏

| –ú–µ—Ç–æ–¥ | –ú–∞—Ä—à—Ä—É—Ç            | –û–ø–∏—Å                    | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è |
| ----- | ------------------ | ----------------------- | ----------- |
| GET   | `/api/cursor`      | –ö—É—Ä—Å–æ—Ä –¥–ª—è –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó    | ‚ùå          |
| GET   | `/api/aggregation` | –ê–≥—Ä–µ–≥–∞—Ü—ñ—è —Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | ‚ùå          |

---

## üìù –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–ø–∏—Ç—ñ–≤

### –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è

```bash
curl -X POST http://localhost:3000/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123"
  }'
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**

```json
{
  "status": "success",
  "message": "–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞",
  "data": {
    "user": {
      "id": "65a1b2c3d4e5f6g7h8i9j0k1",
      "email": "user@example.com",
      "role": "user"
    }
  }
}
```

### –í—Ö—ñ–¥

```bash
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123"
  }' \
  -c cookies.txt
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**

```json
{
  "status": "success",
  "message": "–í—Ö—ñ–¥ —É—Å–ø—ñ—à–Ω–∏–π",
  "data": {
    "user": {
      "id": "65a1b2c3d4e5f6g7h8i9j0k1",
      "email": "user@example.com",
      "role": "user"
    }
  }
}
```

### –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

```bash
curl -X GET http://localhost:3000/auth/me \
  -b cookies.txt
```

### –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –ø—Ä–æ–¥—É–∫—Ç–∏

```bash
curl -X GET http://localhost:3000/api/products
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**

```json
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "name": "–ù–æ—É—Ç–±—É–∫",
      "price": 25000,
      "description": "–ü–æ—Ç—É–∂–Ω–∏–π –Ω–æ—É—Ç–±—É–∫ –¥–ª—è —Ä–æ–±–æ—Ç–∏",
      "category": "electronics",
      "image": "laptop.jpg",
      "stock": 10,
      "rating": 4.5
    }
  ]
}
```

### –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç –∑–∞ ID

```bash
curl -X GET http://localhost:3000/api/products/1
```

### –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç (–ø–æ—Ç—Ä–µ–±—É—î –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó)

```bash
curl -X POST http://localhost:3000/api/products \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{
    "name": "–°–º–∞—Ä—Ç—Ñ–æ–Ω",
    "price": 15000,
    "description": "–°—É—á–∞—Å–Ω–∏–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω –∑ —è–∫—ñ—Å–Ω–æ—é –∫–∞–º–µ—Ä–æ—é",
    "category": "electronics",
    "image": "phone.jpg",
    "stock": 25,
    "rating": 4.2
  }'
```

### –û–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç (–ø–æ—Ç—Ä–µ–±—É—î –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó)

```bash
curl -X PUT http://localhost:3000/api/products/1 \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{
    "price": 30000,
    "stock": 5,
    "rating": 4.7
  }'
```

### –í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç (–ø–æ—Ç—Ä–µ–±—É—î –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó)

```bash
curl -X DELETE http://localhost:3000/api/products/1 \
  -b cookies.txt
```

---

## üîß –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫

### –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

- Node.js 18+
- npm –∞–±–æ yarn
- MongoDB Atlas –∞–∫–∫–∞—É–Ω—Ç (–∞–±–æ –ª–æ–∫–∞–ª—å–Ω–∞ MongoDB)

### –ö—Ä–æ–∫ 1: –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

```bash
git clone https://github.com/PalGalya/dz_js31_48.git
cd dz_js31_48
git checkout dz_js52_71_feature_mongoose-orm-integration
```

### –ö—Ä–æ–∫ 2: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
npm install
```

### –ö—Ä–æ–∫ 3: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è .env

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` —É –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É:

```env
PORT=3000
MONGODB_URI=mongodb+srv://username:password@cluster0.mongodb.net/?retryWrites=true&w=majority
MONGODB_DB_NAME=expressApp
SESSION_SECRET=your-secret-key-change-in-production
```

### –ö—Ä–æ–∫ 4: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

**–†–µ–∂–∏–º —Ä–æ–∑—Ä–æ–±–∫–∏ (–∑ –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º):**

```bash
npm run dev
```

**–†–µ–∂–∏–º –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:**

```bash
npm start
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ `http://localhost:3000`

---

## üë§ –¢–µ—Å—Ç–æ–≤—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ

–¢–µ—Å—Ç–æ–≤—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂–Ω–∞ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ API. –ü—Ä–∏–∫–ª–∞–¥ –¥–ª—è Postman/Insomnia:

```json
{
  "email": "test@example.com",
  "password": "password123"
}
```

---

## üîí –ë–µ–∑–ø–µ–∫–∞

‚ö†Ô∏è **–í–∞–∂–ª–∏–≤–æ:** –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É:

- ‚úÖ **–•–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤** - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `bcrypt` –∑ 10 —Ä–∞—É–Ω–¥–∞–º–∏ —Å–æ–ª—ñ
- ‚úÖ **–ë–µ–∑–ø–µ—á–Ω–∞ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è** - –ü–∞—Ä–æ–ª—ñ –ø–æ—Ä—ñ–≤–Ω—é—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `bcrypt.compare()`
- ‚úÖ **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö** - Celebrate + Joi –ø–µ—Ä–µ–≤—ñ—Ä—è—î —É—Å—ñ –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ
- ‚úÖ **–ó–∞—Ö–∏—â–µ–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏** - Middleware –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç—É–ø–æ–º
- ‚úÖ **–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ NoSQL Injection** - Mongoose + Joi –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∑–∞—Ö–∏—â–∞—é—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –¥–æ–¥–∞—Ç–∫–æ–≤–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:**

- üîê **HTTPS** - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ SSL/TLS —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏
- üîê **CORS** - –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É
- üîê **Rate limiting** - –û–±–º–µ–∂–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤
- üîê **–ë–µ–∑–ø–µ—á–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è** - –ü—Ä–∏—Ö–æ–≤—É–≤–∞—Ç–∏ –≤—Å—ñ —Å–µ–∫—Ä–µ—Ç–Ω—ñ –∫–ª—é—á–∏ –≤ .env

---

## üìä –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö

### –ß–µ—Ä–µ–∑ Celebrate + Joi

```javascript
// –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
{
  email: string, email format, required
  password: string, min 6 chars, required
}

// –ü—Ä–æ–¥—É–∫—Ç
{
  name: string, min 3-max 100, required
  price: number, min 0, required
  description: string, min 10-max 500, required
  category: enum (specific categories), required
}
```

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î

```bash
curl http://localhost:3000/auth/me
```

–ú–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ 401 (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó)

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

1. –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è ‚Üí –û—Ç—Ä–∏–º–∞—Ç–∏ ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
2. –í—Ö—ñ–¥ ‚Üí –û—Ç—Ä–∏–º–∞—Ç–∏ session cookie
3. –î–æ—Å—Ç—É–ø –¥–æ `/auth/me` ‚Üí –ü–æ–≤–∏–Ω–µ–Ω –ø—Ä–∞—Ü—é–≤–∞—Ç–∏
4. –í–∏—Ö—ñ–¥ ‚Üí –í–∏–¥–∞–ª–∏—Ç–∏ session

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è CRUD –ø—Ä–æ–¥—É–∫—Ç—ñ–≤

1. GET `/api/products` ‚Üí –ú–∞—î –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –ø—Ä–æ–¥—É–∫—Ç–∏
2. POST `/api/products` ‚Üí –ü–æ—Ç—Ä–µ–±—É—î –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
3. PUT `/api/products/:id` ‚Üí –û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ
4. DELETE `/api/products/:id` ‚Üí –í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç

---

## üìà –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π

### –£—Å–ø—ñ—à–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å

```json
{
  "status": "success",
  "message": "–û–ø–µ—Ä–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ",
  "data": {
    "user": {
      "id": "1",
      "email": "user@example.com"
    }
  }
}
```

### –ü–æ–º–∏–ª–∫–∞

```json
{
  "status": "error",
  "message": "–û–ø–∏—Å –ø–æ–º–∏–ª–∫–∏"
}
```

---

## üîÑ –í–∞–∂–ª–∏–≤—ñ —Ñ–∞–π–ª–∏ –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

‚úÖ **–ü–µ—Ä–µ—Ä–æ–±–ª–µ–Ωi –∑ raw MongoDB –Ω–∞ Mongoose:**

- `src/models/user.mjs` - User –º–æ–¥–µ–ª—å –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é
- `src/models/product.mjs` - Product –º–æ–¥–µ–ª—å –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é
- `src/auth/passport.mjs` - –û–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ Mongoose
- `src/controllers/auth.mjs` - –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–æ –Ω–∞ Mongoose
- `src/controllers/products.mjs` - –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–æ –Ω–∞ Mongoose
- `src/db/mongodb.mjs` - –û–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ Mongoose
- `src/routes/products.mjs` - –î–æ–¥–∞–Ω–æ PUT —Ç–∞ DELETE –º–∞—Ä—à—Ä—É—Ç–∏

---

## üéì –ù–∞–≤—á–∞–ª—å–Ω—ñ —Ü—ñ–ª—ñ

–ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—é —Ü—å–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É –≤–∏ –±—É–¥–µ—Ç–µ —Ä–æ–∑—É–º—ñ—Ç–∏:

- ‚úÖ –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **Mongoose** —è–∫ ORM –¥–ª—è MongoDB
- ‚úÖ –Ø–∫ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ **–≤–∞–ª—ñ–¥–æ–≤–∞–Ω—ñ —Å—Ö–µ–º–∏** –∑ Mongoose
- ‚úÖ –Ø–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ **CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó** –∑ Mongoose
- ‚úÖ –Ø–∫ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ **Passport.js** –∑ Mongoose
- ‚úÖ –Ø–∫ –±—É–¥—É–≤–∞—Ç–∏ **REST API** –∑ Express + Mongoose
- ‚úÖ –Ø–∫ –∑–∞—Ö–∏—â–∞—Ç–∏ **–º–∞—Ä—à—Ä—É—Ç–∏ —á–µ—Ä–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é**
- ‚úÖ –Ø–∫ –≤–∞–ª—ñ–¥—É–≤–∞—Ç–∏ **–¥–∞–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—É** –∑ Celebrate

---

## üìö –ü–æ—Å–∏–ª–∞–Ω–Ω—è

- [Mongoose –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è](https://mongoosejs.com/)
- [Express.js](https://expressjs.com/)
- [Passport.js](http://www.passportjs.org/)
- [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
- [Celebrate Documentation](https://github.com/arb/celebrate)

---

## üìù –ê–≤—Ç–æ—Ä

–ü–∞–ª–∞–º–∞—Ä—á—É–∫ –ì–∞–ª–∏–Ω–∞
