# Express Server –∑ Passport –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é

**–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è 64.1:** –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–∞ Express –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Passport –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.

**–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è 65:** –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è MongoDB Atlas –∑ —ñ—Å–Ω—É—é—á–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º Express.

## üìã –¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

### 1. –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- Node.js —Ç–∞ Express.js
- MongoDB Atlas

### 2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Passport –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ Passport –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- ‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó Passport (LocalStrategy) –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º email —Ç–∞ –ø–∞—Ä–æ–ª—è
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤ –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó, –≤—Ö–æ–¥—É —Ç–∞ –≤–∏—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

### 3. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–µ—Å—ñ–π

- ‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Express —Å–µ—Å—ñ–π (`express-session`) –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Å–µ—Å—ñ–π –¥–ª—è —Ç—Ä–∏–≤–∞–ª–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ —Å–µ—Å—ñ—ó —É cookies –∑ `httpOnly` —Ç–∞ `secure`

### 4. –î–æ—Å—Ç—É–ø –¥–æ –∑–∞—Ö–∏—â–µ–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É

- ‚úÖ –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–∞—Ö–∏—â–µ–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É `/auth/protected`
- ‚úÖ Middleware Passport –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –≤–∞–ª—ñ–¥–Ω–æ—Å—Ç—ñ —Å–µ—Å—ñ—ó

### 5. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è MongoDB Atlas

- ‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö MongoDB Atlas
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ MongoDB
- ‚úÖ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –Ω–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ–π —Å—Ç–æ—Ä–æ–Ω—ñ

## üöÄ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫

```bash
# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä
npm start

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤ —Ä–µ–∂–∏–º—ñ —Ä–æ–∑—Ä–æ–±–∫–∏
npm run dev
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ `http://localhost:3000`

## üì° API Endpoints

| –ú–µ—Ç–æ–¥ | –ú–∞—Ä—à—Ä—É—Ç           | –û–ø–∏—Å                                | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è |
| ----- | ----------------- | ----------------------------------- | ----------- |
| POST  | `/auth/register`  | –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞       | –ù—ñ          |
| POST  | `/auth/login`     | –í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É                      | –ù—ñ          |
| POST  | `/auth/logout`    | –í–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏                     | –¢–∞–∫         |
| GET   | `/auth/me`        | –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ | –¢–∞–∫         |
| GET   | `/auth/protected` | –ó–∞—Ö–∏—â–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ (–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è)    | –¢–∞–∫         |
| GET   | `/api/products`   | –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤           | –ù—ñ          |

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–ø–∏—Ç—ñ–≤

**–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:**

```bash
curl -X POST http://localhost:3000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"newuser@example.com","password":"password123"}'
```

**–í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É:**

```bash
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"password123"}' \
  -c cookies.txt
```

**–û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:**

```bash
curl -X GET http://localhost:3000/auth/me -b cookies.txt
```

**–î–æ—Å—Ç—É–ø –¥–æ –∑–∞—Ö–∏—â–µ–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏:**

```bash
curl -X GET http://localhost:3000/auth/protected -b cookies.txt
```

**–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –ø—Ä–æ–¥—É–∫—Ç—ñ–≤:**

```bash
curl -X GET http://localhost:3000/api/products
```

**–í–∏—Ö—ñ–¥:**

```bash
curl -X POST http://localhost:3000/auth/logout -b cookies.txt
```

## üë• –¢–µ—Å—Ç–æ–≤—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ

1. **Admin:**

   - Email: `admin@example.com`
   - Password: `password123`

2. **User:**
   - Email: `user@example.com`
   - Password: `userpass`

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
dz_js45_64_express_passport/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app.mjs                   # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –¥–æ–¥–∞—Ç–∫—É
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ passport.mjs          # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Passport (LocalStrategy)
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.mjs              # –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.mjs              # Middleware –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.mjs              # –ú–∞—Ä—à—Ä—É—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.mjs             # –ì–æ–ª–æ–≤–Ω–∏–π —Ä–æ—É—Ç–µ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ products.mjs          # –ú–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mongodb.mjs           # –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MongoDB Atlas
‚îÇ   ‚îî‚îÄ‚îÄ views/
‚îÇ       ‚îî‚îÄ‚îÄ products.html         # –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## üîê –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

- **Passport.js** –∑ LocalStrategy –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ email —Ç–∞ –ø–∞—Ä–æ–ª—å
- **–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –Ω–∞ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å email
- **Express-session** –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–µ—Å—ñ–π
- **Cookies** –∑ httpOnly –¥–ª—è –±–µ–∑–ø–µ–∫–∏
- **Middleware** –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –º–∞—Ä—à—Ä—É—Ç—ñ–≤
- **–í–∞–ª—ñ–¥–∞—Ü—ñ—è** –¥–∞–Ω–∏—Ö (email —Ç–∞ –ø–∞—Ä–æ–ª—å) –∑ Joi —Ç–∞ Celebrate
- **–°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è/–¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É —Å–µ—Å—ñ—ó
- **–î–∏–Ω–∞–º—ñ—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** - –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç–∞ –º–æ–∂—É—Ç—å –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è
- **MongoDB Atlas** –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
- **–ú–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤** –∑ —á–∏—Ç–∞–Ω–Ω—è–º –¥–∞–Ω–∏—Ö –∑ –±–∞–∑–∏
- **–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤** –Ω–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ–π —Å—Ç–æ—Ä–æ–Ω—ñ

## üì¶ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

- `express` - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `passport` - –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- `passport-local` - —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –ª–æ–∫–∞–ª—å–Ω–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- `express-session` - —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏
- `celebrate` + `joi` - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
- `mongodb` - –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ MongoDB

## ‚ö†Ô∏è –ü—Ä–∏–º—ñ—Ç–∫–∞

–¶–µ –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø—Ä–æ–µ–∫—Ç. –ü–∞—Ä–æ–ª—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ. –£ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ:

- –•–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ (bcrypt, argon2)
- –ë–∞–∑—É –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ë–µ–∑–ø–µ—á–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è
- HTTPS –¥–ª—è secure cookies
