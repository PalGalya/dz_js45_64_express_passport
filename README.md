# Express Server –∑ Passport –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é

**–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è 64.1:** –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–∞ Express –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Passport –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.

**–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è 65:** –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è MongoDB Atlas –∑ —ñ—Å–Ω—É—é—á–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º Express.

**–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è 67.1:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫—É—Ä—Å–æ—Ä—ñ–≤ —Ç–∞ –∞–≥—Ä–µ–≥–∞—Ü—ñ–π–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ —É MongoDB —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä Express.

**–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è 70:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–µ–∫—Ç—É –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Mongoose –∑–∞–º—ñ—Å—Ç—å MongoDB Node.js Driver.

## üìã –¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

### 1. –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- Node.js —Ç–∞ Express.js
- MongoDB Atlas
- Mongoose ODM –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ MongoDB

### 2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Passport –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ Passport –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- ‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó Passport (LocalStrategy) –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º email —Ç–∞ –ø–∞—Ä–æ–ª—è
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤ –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó, –≤—Ö–æ–¥—É —Ç–∞ –≤–∏—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

### 3. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–µ—Å—ñ–π

- ‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Express —Å–µ—Å—ñ–π (`express-session`) –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Å–µ—Å—ñ–π –¥–ª—è —Ç—Ä–∏–≤–∞–ª–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ —Å–µ—Å—ñ—ó —É cookies –∑ `httpOnly` —Ç–∞ `secure`

### 4. –î–æ—Å—Ç—É–ø –¥–æ –∑–∞—Ö–∏—â–µ–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É

- ‚úÖ –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–∞—Ö–∏—â–µ–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É `/auth/protected`
- ‚úÖ Middleware Passport –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –≤–∞–ª—ñ–¥–Ω–æ—Å—Ç—ñ —Å–µ—Å—ñ—ó

### 5. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è MongoDB Atlas

- ‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö MongoDB Atlas
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ MongoDB
- ‚úÖ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –Ω–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ–π —Å—Ç–æ—Ä–æ–Ω—ñ

### 6. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑ Mongoose

- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Mongoose ODM –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —è–∫–æ—Å—Ç—ñ –∫–æ–¥—É
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ö–µ–º –¥–∞–Ω–∏—Ö –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é —Ç–∞ —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—î—é
- ‚úÖ –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—Å—ñ—Ö –≤–∑–∞—î–º–æ–¥—ñ–π –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö –Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Mongoose –º–æ–¥–µ–ª–µ–π
- ‚úÖ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ –ø—ñ—Å–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

## üöÄ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫

```bash
# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä
npm start

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤ —Ä–µ–∂–∏–º—ñ —Ä–æ–∑—Ä–æ–±–∫–∏
npm run dev
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ `http://localhost:3000`

## üì° API Endpoints

| –ú–µ—Ç–æ–¥  | –ú–∞—Ä—à—Ä—É—Ç                                  | –û–ø–∏—Å                                             | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è |
| ------ | ---------------------------------------- | ------------------------------------------------ | ----------- |
| POST   | `/auth/register`                         | –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞                    | –ù—ñ          |
| POST   | `/auth/login`                            | –í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É                                   | –ù—ñ          |
| POST   | `/auth/logout`                           | –í–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏                                  | –¢–∞–∫         |
| GET    | `/auth/me`                               | –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞              | –¢–∞–∫         |
| GET    | `/auth/protected`                        | –ó–∞—Ö–∏—â–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ (–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è)                 | –¢–∞–∫         |
| GET    | `/api/products`                          | –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤                        | –ù—ñ          |
| GET    | `/api/products/:id`                      | –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç –∑–∞ ID                           | –ù—ñ          |
| POST   | `/api/products`                          | –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –ø—Ä–æ–¥—É–∫—Ç                           | –¢–∞–∫         |
| POST   | `/api/products/insertOne`                | –î–æ–¥–∞–≤–∞–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞                       | –¢–∞–∫         |
| POST   | `/api/products/insertMany`               | –î–æ–¥–∞–≤–∞–Ω–Ω—è –±–∞–≥–∞—Ç—å–æ—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤                    | –¢–∞–∫         |
| PUT    | `/api/products/updateOne`                | –û–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞                       | –¢–∞–∫         |
| PUT    | `/api/products/updateMany`               | –û–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–≥–∞—Ç—å–æ—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤                    | –¢–∞–∫         |
| PUT    | `/api/products/replaceOne`               | –ó–∞–º—ñ–Ω–∞ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞                          | –¢–∞–∫         |
| DELETE | `/api/products/deleteOne`                | –í–∏–¥–∞–ª–µ–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞                       | –¢–∞–∫         |
| DELETE | `/api/products/deleteMany`               | –í–∏–¥–∞–ª–µ–Ω–Ω—è –±–∞–≥–∞—Ç—å–æ—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤                    | –¢–∞–∫         |
| POST   | `/api/products/findWithProjection`       | –ß–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –ø—Ä–æ–µ–∫—Ü—ñ—î—é                        | –¢–∞–∫         |
| GET    | `/api/cursor/products`                   | –û–±—Ä–æ–±–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫—É—Ä—Å–æ—Ä–∞ (forEach) | –ù—ñ          |
| GET    | `/api/cursor/products/batch`             | –û–±—Ä–æ–±–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∫—É—Ä—Å–æ—Ä–æ–º –∑ –±–∞—Ç—á–∏–Ω–≥–æ–º           | –ù—ñ          |
| GET    | `/api/cursor/products/stream`            | –û–±—Ä–æ–±–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∫—É—Ä—Å–æ—Ä–æ–º –ø–æ—Ç–æ–∫–æ–≤–æ              | –ù—ñ          |
| GET    | `/api/aggregation/products/stats`        | –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (–∞–≥—Ä–µ–≥–∞—Ü—ñ—è)        | –ù—ñ          |
| GET    | `/api/aggregation/products/by-category`  | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏              | –ù—ñ          |
| GET    | `/api/aggregation/products/price-ranges` | –†–æ–∑–ø–æ–¥—ñ–ª –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∑–∞ —Ü—ñ–Ω–æ–≤–∏–º–∏ –¥—ñ–∞–ø–∞–∑–æ–Ω–∞–º–∏       | –ù—ñ          |

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–ø–∏—Ç—ñ–≤

**–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:**

```bash
curl -X POST http://localhost:3000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"newuser@example.com","password":"password123"}'
```

**–í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É:**

```bash
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"password123"}' \
  -c cookies.txt
```

**–û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:**

```bash
curl -X GET http://localhost:3000/auth/me -b cookies.txt
```

**–î–æ—Å—Ç—É–ø –¥–æ –∑–∞—Ö–∏—â–µ–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏:**

```bash
curl -X GET http://localhost:3000/auth/protected -b cookies.txt
```

**–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –ø—Ä–æ–¥—É–∫—Ç—ñ–≤:**

```bash
curl -X GET http://localhost:3000/api/products
```

**–í–∏—Ö—ñ–¥:**

```bash
curl -X POST http://localhost:3000/auth/logout -b cookies.txt
```

**–î–æ–¥–∞–≤–∞–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**

```bash
curl -X POST http://localhost:3000/api/products/insertOne \
  -H "Content-Type: application/json" \
  -d '{"name":"Product1","price":100,"description":"Description","category":"Category"}'
```

**–î–æ–¥–∞–≤–∞–Ω–Ω—è –±–∞–≥–∞—Ç—å–æ—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤:**

```bash
curl -X POST http://localhost:3000/api/products/insertMany \
  -H "Content-Type: application/json" \
  -d '[{"name":"Product1","price":100,"description":"Description 1","category":"Category 1"},{"name":"Product2","price":200,"description":"Description 2","category":"Category 2"}]'
```

**–û–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**

```bash
curl -X PUT http://localhost:3000/api/products/updateOne \
  -H "Content-Type: application/json" \
  -d '{"filter":{"name":"Product1"},"update":{"$set":{"price":150}}}'
```

**–û–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–≥–∞—Ç—å–æ—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤:**

```bash
curl -X PUT http://localhost:3000/api/products/updateMany \
  -H "Content-Type: application/json" \
  -d '{"filter":{"price":{"$lt":200}},"update":{"$set":{"price":200}}}'
```

**–ó–∞–º—ñ–Ω–∞ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**

```bash
curl -X PUT http://localhost:3000/api/products/replaceOne \
  -H "Content-Type: application/json" \
  -d '{"filter":{"name":"Product1"},"replacement":{"name":"Product1","price":300,"description":"New description","category":"Category"}}'
```

**–í–∏–¥–∞–ª–µ–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**

```bash
curl -X DELETE http://localhost:3000/api/products/deleteOne \
  -H "Content-Type: application/json" \
  -d '{"filter":{"name":"Product1"}}'
```

**–í–∏–¥–∞–ª–µ–Ω–Ω—è –±–∞–≥–∞—Ç—å–æ—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤:**

```bash
curl -X DELETE http://localhost:3000/api/products/deleteMany \
  -H "Content-Type: application/json" \
  -d '{"filter":{"price":{"$lt":200}}}'
```

**–ß–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –ø—Ä–æ–µ–∫—Ü—ñ—î—é:**

```bash
curl -X POST http://localhost:3000/api/products/findWithProjection \
  -H "Content-Type: application/json" \
  -d '{"filter":{},"projection":{"name":1,"price":1,"_id":0}}'
```

**–û–±—Ä–æ–±–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫—É—Ä—Å–æ—Ä–∞ (forEach):**

```bash
curl -X GET http://localhost:3000/api/cursor/products
```

**–û–±—Ä–æ–±–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∫—É—Ä—Å–æ—Ä–æ–º –∑ –±–∞—Ç—á–∏–Ω–≥–æ–º:**

```bash
curl -X GET http://localhost:3000/api/cursor/products/batch?batchSize=3
```

**–ü–æ—Ç–æ–∫–æ–≤–∞ –æ–±—Ä–æ–±–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∫—É—Ä—Å–æ—Ä–æ–º:**

```bash
curl -X GET http://localhost:3000/api/cursor/products/stream
```

**–ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤:**

```bash
curl -X GET http://localhost:3000/api/aggregation/products/stats
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏:**

```bash
curl -X GET http://localhost:3000/api/aggregation/products/by-category
```

**–†–æ–∑–ø–æ–¥—ñ–ª –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∑–∞ —Ü—ñ–Ω–æ–≤–∏–º–∏ –¥—ñ–∞–ø–∞–∑–æ–Ω–∞–º–∏:**

```bash
curl -X GET http://localhost:3000/api/aggregation/products/price-ranges
```

## üóÑÔ∏è Mongoose –ú–æ–¥–µ–ª—ñ

### Product Model (`src/models/product.mjs`)

```javascript
{
  name: {
    type: String,
    required: true,
    trim: true,
  },
  price: {
    type: Number,
    required: true,
    min: 0,
  },
  category: {
    type: String,
    required: true,
    enum: ['electronics', 'clothing', 'food', 'furniture'],
  },
  stock: {
    type: Number,
    default: 0,
  },
  createdAt: Date,    // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
  updatedAt: Date,    // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
}
```

### User Model (`src/models/user.mjs`)

```javascript
{
  username: {
    type: String,
    required: true,
    unique: true,
    trim: true,
  },
  password: {
    type: String,
    required: true,
  },
  email: {
    type: String,
    required: true,
    unique: true,
    match: /.+@.+\..+/,
  },
  role: {
    type: String,
    default: 'user',
    enum: ['user', 'admin'],
  },
  createdAt: Date,    // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
  updatedAt: Date,    // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
}
```

### –ü–µ—Ä–µ–≤–∞–≥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Mongoose

1. **–°—Ö–µ–º–∏ –¥–∞–Ω–∏—Ö**: –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é
2. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∏–ø—ñ–≤ –¥–∞–Ω–∏—Ö —Ç–∞ –æ–±–º–µ–∂–µ–Ω—å
3. **Middleware**: –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –¥–æ–¥–∞–≤–∞–Ω–Ω—è pre/post —Ö—É–∫—ñ–≤
4. **–ü–æ–ø—É–ª—è—Ü—ñ—è**: –õ–µ–≥–∫–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∑–≤'—è–∑–∫—ñ–≤ –º—ñ–∂ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ timestamps**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è createdAt/updatedAt
6. **–ö—Ä–∞—â–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –ë—ñ–ª—å—à –∑—Ä—É—á–Ω–∏–π API –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ MongoDB

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Mongoose —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—ñ —Ä–æ–±–æ—Ç–∏ –ø—ñ—Å–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É –Ω–∞ Mongoose –∑–∞–ø—É—Å—Ç—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç:

```bash
node test-mongoose.mjs
```

–¶–µ–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î:

- ‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- ‚úÖ –ß–∏—Ç–∞–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- ‚úÖ –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- ‚úÖ –ê–≥—Ä–µ–≥–∞—Ü—ñ–π–Ω—ñ –∑–∞–ø–∏—Ç–∏

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É —Ç–µ—Å—Ç—ñ–≤

```
üß™ Testing Mongoose integration...
‚úÖ Database connection successful
üìä Total products in database: 5
‚úÖ Product creation test successful: Test Product
‚úÖ Product reading test successful: Found 5 products
‚úÖ Product update test successful
‚úÖ Product deletion test successful
‚úÖ Aggregation test successful: { _id: null, totalProducts: 5, avgPrice: 26300 }
üéâ All Mongoose integration tests passed!
```

## üë• –¢–µ—Å—Ç–æ–≤—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ

1. **Admin:**

   - Email: `admin@example.com`
   - Password: `password123`

2. **User:**
   - Email: `user@example.com`
   - Password: `userpass`

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
dz_js45_64_express_passport/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app.mjs                   # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –¥–æ–¥–∞—Ç–∫—É
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ passport.mjs          # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Passport (LocalStrategy)
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.mjs              # –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ products.mjs          # –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.mjs              # Middleware –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.mjs           # Mongoose –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.mjs              # Mongoose –º–æ–¥–µ–ª—å –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.mjs              # –ú–∞—Ä—à—Ä—É—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.mjs             # –ì–æ–ª–æ–≤–Ω–∏–π —Ä–æ—É—Ç–µ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products.mjs          # –ú–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cursor.mjs            # –ú–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –∫—É—Ä—Å–æ—Ä–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ aggregation.mjs       # –ú–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü—ñ–π–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mongodb.mjs           # –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MongoDB —á–µ—Ä–µ–∑ Mongoose
‚îÇ   ‚îî‚îÄ‚îÄ config.mjs                # –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∑ .env
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ products.html             # –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
‚îú‚îÄ‚îÄ test-mongoose.mjs             # –¢–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ Mongoose —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
‚îú‚îÄ‚îÄ .env                          # –§–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## üîê –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

- **Passport.js** –∑ LocalStrategy –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ email —Ç–∞ –ø–∞—Ä–æ–ª—å
- **–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –Ω–∞ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å email
- **Express-session** –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–µ—Å—ñ–π
- **Cookies** –∑ httpOnly –¥–ª—è –±–µ–∑–ø–µ–∫–∏
- **Middleware** –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –º–∞—Ä—à—Ä—É—Ç—ñ–≤
- **–í–∞–ª—ñ–¥–∞—Ü—ñ—è** –¥–∞–Ω–∏—Ö (email —Ç–∞ –ø–∞—Ä–æ–ª—å) –∑ Joi —Ç–∞ Celebrate
- **–°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è/–¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É —Å–µ—Å—ñ—ó
- **–î–∏–Ω–∞–º—ñ—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** - –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç–∞ –º–æ–∂—É—Ç—å –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è
- **MongoDB Atlas** –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
- **–ú–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤** –∑ —á–∏—Ç–∞–Ω–Ω—è–º –¥–∞–Ω–∏—Ö –∑ –±–∞–∑–∏
- **–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤** –Ω–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ–π —Å—Ç–æ—Ä–æ–Ω—ñ
- **–§–∞–π–ª config.mjs** –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∑ `.env`
- **–ö—É—Ä—Å–æ—Ä–∏ MongoDB** –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏ –≤–µ–ª–∏–∫–∏—Ö –Ω–∞–±–æ—Ä—ñ–≤ –¥–∞–Ω–∏—Ö
- **–ê–≥—Ä–µ–≥–∞—Ü—ñ–π–Ω—ñ –∑–∞–ø–∏—Ç–∏** –¥–ª—è –∑–±–æ—Ä—É —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö (—Å–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è, —Å—É–º–∞, –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å)
- **–ë–∞—Ç—á–∏–Ω–≥** —Ç–∞ **–ø–æ—Ç–æ–∫–æ–≤–∞ –æ–±—Ä–æ–±–∫–∞** –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫—É—Ä—Å–æ—Ä—ñ–≤
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏** —Ç–∞ **—Ü—ñ–Ω–æ–≤–∏–º–∏ –¥—ñ–∞–ø–∞–∑–æ–Ω–∞–º–∏** —á–µ—Ä–µ–∑ –∞–≥—Ä–µ–≥–∞—Ü—ñ—é
- **Mongoose ODM** –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ MongoDB
- **–°—Ö–µ–º–∏ Mongoose** –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é —Ç–∞ —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—î—é –ø–æ–ª—ñ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è timestamps** (createdAt, updatedAt)
- **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ —Ä—ñ–≤–Ω—ñ –º–æ–¥–µ–ª—ñ** (—Ç–∏–ø–∏ –¥–∞–Ω–∏—Ö, –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è, –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—è)

## üì¶ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

- `express` - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `passport` - –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- `passport-local` - —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –ª–æ–∫–∞–ª—å–Ω–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- `express-session` - —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏
- `celebrate` + `joi` - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
- `mongodb` - –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ MongoDB
- `mongoose` - ODM –¥–ª—è MongoDB –∑ —Å—Ö–µ–º–∞–º–∏ —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é
- `dotenv` - –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è

## ‚ö†Ô∏è –ü—Ä–∏–º—ñ—Ç–∫–∞

–¶–µ –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø—Ä–æ–µ–∫—Ç. –ü–∞—Ä–æ–ª—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ. –£ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ:

- –•–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ (bcrypt, argon2)
- –ë–∞–∑—É –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ë–µ–∑–ø–µ—á–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è
- HTTPS –¥–ª—è secure cookies

## ‚ö†Ô∏è –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

- –£ –ø—Ä–æ–µ–∫—Ç—ñ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ middleware `celebrate`.
- –î–ª—è —Ü—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `app.use(errors())`, —â–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—Ä–æ–±–ª—è—î –ø–æ–º–∏–ª–∫–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON.

### –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–º–∏–ª–∫–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

```bash
curl -X POST http://localhost:3000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"invalid","password":"123"}'
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**

```json
{
  "statusCode": 400,
  "error": "Bad Request",
  "message": "Validation failed",
  "validation": {
    "body": {
      "email": "must be a valid email",
      "password": "length must be at least 6 characters long"
    }
  }
}
```

### ‚ö° –í–∏–º–æ–≥–∏ –¥–æ –ø–∞—Ä–æ–ª—è

- –ü–∞—Ä–æ–ª—å –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤.

### –ü—Ä–∏–∫–ª–∞–¥ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –∑ –≤–∞–ª—ñ–¥–Ω–∏–º –ø–∞—Ä–æ–ª–µ–º

```bash
curl -X POST http://localhost:3000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"secure123"}'
```
